<app-header></app-header>
<div class="container">
  <p-scrollTop
    [threshold]="100"
    class="bg-orange-600 custom-scroll-top"
    icon="pi pi-arrow-up"
  ></p-scrollTop>
  <div class="card">
    <section class="wrap-header pr-3 pl-3">
      <div class="nav-header-menu"></div>

      <div class="main-menu grid grid-cols-12 gap-4">
        <p-carousel
          class="col-span-8 slide-banner"
          [value]="this.dataBanner"
          [numVisible]="1"
          [numScroll]="1"
          [circular]="false"
          [autoplayInterval]="3000"
        >
          <ng-template let-product pTemplate="item">
            <img
              src="{{ product.image }}"
              [alt]="product.name"
              class="w-full p-0 h-[32rem]"
            />
          </ng-template>
        </p-carousel>

        <!-- Hiển thị lịch booking -->
        <div
          class="h-[32rem] header-right-content col-span-4 bg-[#D8EFFF] rounded-lg dark:bg-gray-800 dark:border-gray-700"
        >
          <!-- Hiển thị thời gian -->
          <div class="clock-time w-full h-2/5">
            <img
              class="w-full h-full"
              src="https://i.pinimg.com/564x/38/16/b1/3816b1e8a43c28b0bb32bdcc3c68e14c.jpg"
            />

            <!-- Đếm thời gian hiện tại -->
            <div class="count-time">
              <p class="first-text">{{ currentDateTime | date : "h:mm a" }}</p>
              <p class="second-text">
                {{ currentDateTime | date : "EEEE, MMMM d, y" }}
              </p>
            </div>

            <!-- Hiển thị lịch học / section -->
            <div class="section-study">
              <ng-container
                *ngIf="
                  dataScheduleMeetings.length > 0;
                  else emptyDataScheduleMeeting
                "
              >
                <div
                  *ngFor="let data of dataScheduleMeetings"
                  class="section-study-obj"
                >
                  <div class="flex flex-column items-start">
                    <div class="flex flex-row items-center gap-2">
                      <p class="title p-0">{{ data.title }}</p>
                      <!-- Giá và nút đăng ký -->
                      <div class="price-register flex flex-row">
                        <ng-container
                          *ngIf="
                            checkUserRegisterScheduleMeeting(data);
                            else userNotRegisterScheduleMeeting
                          "
                        >
                          <button
                            type="button"
                            class="text-white bg-gradient-to-br from-[#5edff5] to-[#9f80f8] hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-green-200 dark:focus:ring-green-800 font-medium rounded-lg text-sm px-4 py-2 text-center"
                          >
                            Đã đăng ký
                          </button>
                        </ng-container>
                        <ng-template #userNotRegisterScheduleMeeting>
                          <button
                            (click)="toggleRegisterScheduleMeeting(data)"
                            type="button"
                            class="text-white bg-gradient-to-br from-[#5edff5] to-[#9f80f8] hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-green-200 dark:focus:ring-green-800 font-medium rounded-lg text-sm px-4 py-2 text-center"
                          >
                            Tham gia
                          </button></ng-template
                        >
                      </div>
                    </div>

                    <h2 class="host-name">HOST: {{ data.lecture.fullName }}</h2>
                  </div>

                  <!-- Thời gian -->
                  <div class="duration flex flex-row">
                    <p class="time-start mr-2">
                      {{ data.timeStart | date : "h:mm a" }}
                    </p>
                    -
                    {{ data.timeEnd | date : "h:mm a" }}
                    <p class="ml-3">
                      {{ data.timeStart | date : "EEEE, MMMM d, y" }}
                    </p>
                  </div>

                  <p
                    [pTooltip]="'Xem tất cả các lịch giảng trực tuyến'"
                    class="view-all pr-7 w-full text-center text-base align-items-center"
                  >
                    Xem tất cả
                  </p>
                </div>
              </ng-container>
              <ng-template #emptyDataScheduleMeeting>
                <p class="text-[1.2rem] w-full h-full text-center mt-2">
                  Hiện tại chưa có lịch giảng nào!
                </p>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Checking Daily -->
  <div class="checking-daily">
    <ng-container *ngIf="!userInfo; else userLogged">
      <div
        class="content left flex flex-column justify-content-center align-items-center"
      >
        <h3 class="font-bold">Ưu đãi nhận Point</h3>
        <div class="coin-already">
          <img
            width="50"
            height="50"
            src="https://firebasestorage.googleapis.com/v0/b/unicourse-f4020.appspot.com/o/Temp%2Fdollar.png?alt=media&token=bfaf0acf-9c25-4c88-89f1-0e7ee63abed0"
            alt="coins"
          />
          <p class="coin-text">{{ getTotalCoin }} UNI Point</p>
        </div>
        <div class="day-container">
          <ng-container
            *ngFor="let event of dataCheckingDailyEvent; index as i"
          >
            <ng-container
              *ngIf="checkEventToday(event.day); else NotEventToday"
            >
              <div class="day-detail">
                <div class="form-coin-active">
                  <span>+100</span>
                  <img
                    width="30"
                    height="30"
                    src="https://firebasestorage.googleapis.com/v0/b/unicourse-f4020.appspot.com/o/Temp%2Fdollar.png?alt=media&token=bfaf0acf-9c25-4c88-89f1-0e7ee63abed0"
                    alt="coins"
                  />
                </div>

                <p class="active-day">Hôm nay</p>
                <div
                  (click)="attendCheckingDailyEvent(event._id)"
                  class="btn-take-coin bg-gradient-to-br from-[#5edff5] to-[#9f80f8] hover:bg-gradient-to-bl"
                >
                  <p class="m-0">Nhận ngay 100 UNI Point</p>
                </div>
              </div>
            </ng-container>
            <ng-template #NotEventToday>
              <div class="day-detail">
                <div class="form-coin">
                  <span>+{{ event.coin }}</span>
                  <img
                    width="30"
                    height="30"
                    src="https://firebasestorage.googleapis.com/v0/b/unicourse-f4020.appspot.com/o/Temp%2Fdollar.png?alt=media&token=bfaf0acf-9c25-4c88-89f1-0e7ee63abed0"
                    alt="coins"
                  />
                </div>
                <p>Ngày {{ i + 1 }}</p>
              </div>
            </ng-template>
          </ng-container>
        </div>
      </div>
    </ng-container>
    <ng-template #userLogged>
      <div
        class="content left flex flex-column justify-content-center align-items-center"
      >
        <h3 class="font-bold">Ưu đãi nhận Point</h3>
        <div class="coin-already">
          <img
            width="50"
            height="50"
            src="https://firebasestorage.googleapis.com/v0/b/unicourse-f4020.appspot.com/o/Temp%2Fdollar.png?alt=media&token=bfaf0acf-9c25-4c88-89f1-0e7ee63abed0"
            alt="coins"
          />
          <p class="coin-text">{{ getTotalCoin }} UNI Point</p>
          <i
            routerLink="/uni-coins"
            class="pi pi-angle-right"
            style="font-size: 2rem"
            pTooltip="Xem chi tiết UNI Point của bạn"
          ></i>
        </div>
        <div class="day-container">
          <ng-container
            *ngFor="let event of dataCheckingDailyEvent; index as i"
          >
            <ng-container
              *ngIf="checkEventToday(event.day); else NotEventToday"
            >
              <div class="day-detail">
                <div class="form-coin-active">
                  <span>+100</span>
                  <img
                    width="30"
                    height="30"
                    src="https://firebasestorage.googleapis.com/v0/b/unicourse-f4020.appspot.com/o/Temp%2Fdollar.png?alt=media&token=bfaf0acf-9c25-4c88-89f1-0e7ee63abed0"
                    alt="coins"
                  />
                </div>

                <ng-container
                  *ngIf="
                    checkUserJoinEvent(event.list_users);
                    else expiredAndNotCheckin
                  "
                >
                  <div class="flex items-center justify-center">
                    <img
                      [ngStyle]="{ width: '3rem' }"
                      class="flex items-center"
                      src="https://deo.shopeemobile.com/shopee/shopee-pcmall-live-sg/dailycheckin/00d5f0b0136ba898b7684a755f587183.png"
                    />
                  </div>

                  <div
                    class="btn-take-coin-back bg-gradient-to-br from-[#5edff5] to-[#9f80f8] hover:bg-gradient-to-bl"
                  >
                    <p class="m-0">
                      Quay lại vào ngày mai để nhận 100 UNI Point
                    </p>
                  </div>
                </ng-container>
                <ng-template #expiredAndNotCheckin>
                  <p class="active-day">Hôm nay</p>
                  <div
                    (click)="attendCheckingDailyEvent(event._id)"
                    class="btn-take-coin bg-gradient-to-br from-[#5edff5] to-[#9f80f8] hover:bg-gradient-to-bl"
                  >
                    <p class="m-0">Nhận ngay 100 UNI Point</p>
                  </div>
                </ng-template>
              </div>
            </ng-container>
            <ng-template #NotEventToday>
              <ng-container
                *ngIf="checkEventExpired(event.day); else isNotExpired"
              >
                <div class="day-detail">
                  <div class="form-coin">
                    <span>+{{ event.coin }}</span>
                    <img
                      width="30"
                      height="30"
                      src="https://firebasestorage.googleapis.com/v0/b/unicourse-f4020.appspot.com/o/Temp%2Fdollar.png?alt=media&token=bfaf0acf-9c25-4c88-89f1-0e7ee63abed0"
                      alt="coins"
                    />
                  </div>
                  <ng-container
                    *ngIf="
                      checkUserJoinEvent(event.list_users);
                      else expiredAndNotCheckin
                    "
                  >
                    <div class="flex items-center justify-center">
                      <img
                        [ngStyle]="{ width: '3rem' }"
                        class="flex items-center"
                        src="https://deo.shopeemobile.com/shopee/shopee-pcmall-live-sg/dailycheckin/00d5f0b0136ba898b7684a755f587183.png"
                      />
                    </div>
                  </ng-container>
                  <ng-template #expiredAndNotCheckin>
                    <p [ngStyle]="{ color: '#f09d8c', 'font-weight': 'bold' }">
                      Quá hạn
                    </p>
                  </ng-template>
                </div>
              </ng-container>
              <ng-template #isNotExpired>
                <div class="day-detail">
                  <div class="form-coin">
                    <span>+{{ event.coin }}</span>
                    <img
                      width="30"
                      height="30"
                      src="https://firebasestorage.googleapis.com/v0/b/unicourse-f4020.appspot.com/o/Temp%2Fdollar.png?alt=media&token=bfaf0acf-9c25-4c88-89f1-0e7ee63abed0"
                      alt="coins"
                    />
                  </div>
                  <p>Ngày {{ i + 1 }}</p>
                </div>
              </ng-template>
            </ng-template>
          </ng-container>
        </div>
      </div>
    </ng-template>
  </div>

  <!-- Educational Programs -->
  <!-- <div class="edu-program">
    <div class="title flex flex-column align-items-center justify-center">
      <h3 class="mt-0 font-bold">Chương trình giảng dạy</h3>
      <p class="mb-6">
        Sứ mệnh của chúng tôi là đảm bảo rằng tất cả sinh viên đều được cung cấp
        các dịch vụ hỗ trợ và các khóa học chất lượng cao, với mức giá phải
        chăng
      </p>
    </div>
    <div class="detail gird flex flex-row justify-content-center gap-4">
      <div
        class="col-4 detail-item-1 flex flex-column justify-content-center align-items-center"
      >
        <img
          width="100"
          height="100"
          src="https://img.icons8.com/bubbles/100/education.png"
          alt="education"
        />
        <div class="text-center">
          <h3>Giáo Dục</h3>
          <p class="p-2">
            Cung cấp các khóa học chất lượng cao, với độ ngũ mentor có nhiều năm
            kinh nghiệm giảng dạy
          </p>
        </div>
      </div>
      <div
        class="col-4 detail-item-2 flex flex-column justify-content-center align-items-center"
      >
        <img
          width="100"
          height="100"
          src="https://img.icons8.com/bubbles/100/define-location.png"
          alt="define-location"
        />
        <div class="text-center">
          <h3>Mục Tiêu</h3>
          <p class="p-2">
            Mong muốn sẽ giúp hơn 1000 sinh viên IT trường ĐH FPT sẽ có nhiều
            kiến thức, kinh nghiệm
          </p>
        </div>
      </div>
      <div
        class="col-4 detail-item-3 flex flex-column justify-content-center align-items-center"
      >
        <img
          width="100"
          height="100"
          src="https://img.icons8.com/bubbles/100/cyber-security.png"
          alt="cyber-security"
        />
        <div class="text-center">
          <h3>Bảo Mật</h3>
          <p class="p-2">
            Chúng tôi cam kết rằng hệ thống sẽ bảo mật thông tin người dùng một
            cách an toàn nhất
          </p>
        </div>
      </div>
    </div>
  </div> -->

  <!-- Các khóa học của Học kỳ 1 -->
  <ng-container *ngIf="this.semester1 && this.semester1.length > 0">
    <div class="semester">
      <span
        [ngStyle]="{
          color: '#82919b',
          'font-size': '14px',
          'font-weight': '600'
        }"
        >20+ người đã học</span
      >
      <div class="title flex flex-row relative">
        <div class="flex flex-row gap-1">
          <h1 [ngStyle]="{ color: '#242424', 'font-weight': '900' }">
            Khóa Học kỳ 1
          </h1>
          <p-badge [value]="'Nổi bật'" severity="danger"></p-badge>
        </div>
        <div class="road-map">
          <p>Xem lộ trình</p>
          <i class="icon pi pi-angle-right" style="font-size: 1.2rem"></i>
        </div>
      </div>

      <div class="flex flex-wrap align-items-center justify-content-start">
        <div *ngFor="let course of semester1" class="course col-3">
          <img src="{{ course.thumbnail }}" />
          <button
            class="register-button flipup animation-duration-300"
            [style]="{
              'border-radius': '10px'
            }"
          >
            <span
              (click)="hanleGetCourseDetail(course._id)"
              class="font-bold bg-gradient-to-br from-[#5edff5] to-[#9f80f8] p-3"
              [style]="{ color: '#ffffff', 'border-radius': '10px' }"
              >Xem khóa học</span
            >
          </button>
          <h3
            class="mb-1 mt-1 text-lg"
            [ngStyle]="{
              color: '#292929'
            }"
          >
            {{ course.title }}
          </h3>
          <div class="flex flex-row gap-2 align-items-center">
            <i class="pi pi-users" style="color: #708090"></i>
            <span>{{ course.enrollmentCount }} người đã tham gia</span>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Các khóa học của Học kỳ 2 -->
  <ng-container *ngIf="this.semester2 && this.semester2.length > 0">
    <div class="semester">
      <span
        [ngStyle]="{
          color: '#82919b',
          'font-size': '14px',
          'font-weight': '600'
        }"
        >20+ người đã học</span
      >
      <div class="title flex flex-row relative">
        <div class="flex flex-row gap-1">
          <h1 [ngStyle]="{ color: '#242424', 'font-weight': '900' }">
            Khóa Học kỳ 2
          </h1>
          <p-badge [value]="'Nổi bật'" severity="danger"></p-badge>
        </div>
        <div class="road-map">
          <p>Xem lộ trình</p>
          <i class="icon pi pi-angle-right" style="font-size: 1.2rem"></i>
        </div>
      </div>

      <div class="flex flex-wrap align-items-center justify-content-start">
        <div *ngFor="let course of semester2" class="course col-3">
          <img class="img-course" src="{{ course.thumbnail }}" />
          <button
            class="register-button flipup animation-duration-300"
            [style]="{
              'border-radius': '10px'
            }"
          >
            <span
              (click)="hanleGetCourseDetail(course._id)"
              class="font-bold bg-gradient-to-br from-[#5edff5] to-[#9f80f8] p-3"
              [style]="{ color: '#ffffff', 'border-radius': '10px' }"
              >Xem khóa học</span
            >
          </button>
          <h3
            class="mb-1 mt-1 text-lg"
            [ngStyle]="{
              color: '#292929'
            }"
          >
            {{ course.title }}
          </h3>
          <div class="flex flex-row gap-2 align-items-center">
            <i class="pi pi-users" style="color: #708090"></i>
            <span>{{ course.enrollmentCount }} người đã tham gia</span>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Các khóa học của Học kỳ 3 -->
  <ng-container *ngIf="this.semester3 && this.semester3.length > 0">
    <div class="semester">
      <span
        [ngStyle]="{
          color: '#82919b',
          'font-size': '14px',
          'font-weight': '600'
        }"
        >20+ người đã học</span
      >
      <div class="title flex flex-row relative">
        <div class="flex flex-row gap-1">
          <h1 [ngStyle]="{ color: '#242424', 'font-weight': '900' }">
            Khóa Học kỳ 3
          </h1>
          <p-badge [value]="'Nổi bật'" severity="danger"></p-badge>
        </div>
        <div class="road-map">
          <p>Xem lộ trình</p>
          <i class="icon pi pi-angle-right" style="font-size: 1.2rem"></i>
        </div>
      </div>

      <div class="flex flex-wrap align-items-center justify-content-start">
        <div *ngFor="let course of semester3" class="course col-3">
          <img
            [ngStyle]="{ 'object-fit': 'contain' }"
            src="{{ course.thumbnail }}"
          />
          <button
            class="register-button flipup animation-duration-300"
            [style]="{
              'border-radius': '10px'
            }"
          >
            <span
              (click)="hanleGetCourseDetail(course._id)"
              class="font-bold bg-gradient-to-br from-[#5edff5] to-[#9f80f8] p-3"
              [style]="{ color: '#ffffff', 'border-radius': '10px' }"
              >Xem khóa học</span
            >
          </button>
          <h3
            class="mb-1 mt-1 text-lg"
            [ngStyle]="{
              color: '#292929'
            }"
          >
            {{ course.title }}
          </h3>
          <div class="flex flex-row gap-2 align-items-center">
            <i class="pi pi-users" style="color: #708090"></i>
            <span>{{ course.enrollmentCount }} người đã tham gia</span>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Feedback -->
  <div
    class="feedback bg-[#D8EFFF] flex flex-column justify-content-center align-items-center"
  >
    <h2>Cảm nhận của học viên về Unicourse?</h2>
    <div class="user grid flex flex-row">
      <div class="col-4 text-center">
        <div class="fb-user p-4">
          <p-avatar
            image="https://firebasestorage.googleapis.com/v0/b/unicourse-f4020.appspot.com/o/Temp%2Ficons8-person-100.png?alt=media&token=b286a20f-ba68-4a8b-8b44-c210da1e2875"
            styleClass="mr-2"
            size="large"
            shape="circle"
          ></p-avatar>
          <h4>Bùi Đức Trí</h4>
          <p-rating
            [(ngModel)]="value"
            [readonly]="true"
            [cancel]="false"
          ></p-rating>
          <p>
            Các khóa học của Unicourse rất bổ ích với mình. Nhờ các khóa học mà
            minh đạt được thành tích tốt trong kỳ vừa rồi.
          </p>
        </div>
      </div>
      <div class="col-4 text-center">
        <div class="fb-user-2 p-4">
          <p-avatar
            image="https://firebasestorage.googleapis.com/v0/b/unicourse-f4020.appspot.com/o/Temp%2Ficons8-person-100.png?alt=media&token=b286a20f-ba68-4a8b-8b44-c210da1e2875"
            styleClass="mr-2"
            size="large"
            shape="circle"
          ></p-avatar>
          <h4>Đinh Gia Bảo</h4>
          <p-rating
            [(ngModel)]="value"
            [readonly]="true"
            [cancel]="false"
          ></p-rating>
          <p>
            Nhờ có khóa học React của Unicourse mà mình đã làm được project cá
            nhân khá chỉnh chu. Cảm ơn Unicourse rất nhiều.
          </p>
        </div>
      </div>
      <div class="col-4 text-center">
        <div class="fb-user p-4">
          <p-avatar
            image="https://firebasestorage.googleapis.com/v0/b/unicourse-f4020.appspot.com/o/Temp%2Ficons8-person-100.png?alt=media&token=b286a20f-ba68-4a8b-8b44-c210da1e2875"
            styleClass="mr-2"
            size="large"
            shape="circle"
          ></p-avatar>
          <h4>Nguyễn Trung Kiên</h4>
          <p-rating
            [(ngModel)]="value"
            [readonly]="true"
            [cancel]="false"
          ></p-rating>
          <p>
            Các giảng viên của Unicourse rất nhiệt huyết và giảng dạy rất có
            tâm.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Contact -->
  <div class="contact pb-5">
    <div
      class="content flex flex-column align-items-center justify-content-center relative"
    >
      <h3 class="m-1">Tư vấn nhận ưu đãi ngay</h3>
      <p>
        Đừng ngần ngại để lại cho chúng tôi email của bạn, chúng tôi sẽ gửi cho
        bạn những ưu đãi hấp dẫn nhất. Hãy đăng ký ngay!
      </p>
      <p-inputGroup class="w-25rem h-3rem m-4">
        <input
          type="text"
          [style]="{ 'padding-left': '1rem' }"
          pInputText
          placeholder="Nhập mail của bạn"
        />
        <button
          pButton
          class="bg-[#F1B300] w-4"
          [style]="{ 'padding-left': '1rem', 'padding-right': '1rem' }"
        >
          <p class="font-bold w-full" [ngStyle]="{ color: '#000' }">Đăng ký</p>
        </button>
      </p-inputGroup>
    </div>
  </div>
</div>

<!-- Modal xác nhận đăng ký lịch giảng -->
<p-dialog
  header="Header"
  [(visible)]="isToggleRegisterScheduleMeeting"
  [modal]="true"
  [style]="{ width: '40rem' }"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
  *ngIf="scheduleData"
>
  <ng-template pTemplate="header">
    <div class="inline-flex align-items-center justify-content-center gap-2">
      <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">
        Xác nhận tham gia
      </h2>
    </div>
  </ng-template>

  <div class="modal-body">
    <p class="text-2xl font-bold">{{ scheduleData.title }}</p>
    <p>HOST: {{ scheduleData.lecture.fullName }}</p>
    <div class="duration flex flex-row">
      <p class="time-start mr-2">
        {{ scheduleData.timeStart | date : "h:mm a" + " -" }}
      </p>
      <p>{{ scheduleData.timeEnd | date : "h:mm a" }}</p>
      <p class="ml-3">
        {{ scheduleData.timeStart | date : "EEEE, MMMM d, y" }}
      </p>
    </div>

    <div>
      <button
        (click)="handleRegisterScheduleMeeting()"
        type="submit"
        class="w-full mt-2 text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-xl px-5 py-3 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
      >
        {{ scheduleData.price }} UNI Point
      </button>
    </div>
  </div>
</p-dialog>

<!-- Modal nạp điểm -->
<p-dialog
  header="Header"
  [(visible)]="isToggleDepositPoint"
  [modal]="true"
  [style]="{ width: '40rem' }"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
>
  <ng-template pTemplate="header">
    <div class="inline-flex align-items-center justify-content-center gap-2">
      <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">
        Có rắc rối rồi!
      </h2>
    </div>
  </ng-template>

  <div class="modal-body">
    <p>
      Rất tiếc, bạn cần {{ scheduleData && scheduleData.price }} UNI Point để
      thực hiện hành động này.
    </p>

    <div>
      <button
        [routerLink]="['/coin-banking']"
        type="submit"
        class="w-full mt-2 text-white bg-[#97D5FE] hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-xl px-5 py-3 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
      >
        Nạp UNI Point ngay
      </button>
    </div>
  </div>
</p-dialog>
