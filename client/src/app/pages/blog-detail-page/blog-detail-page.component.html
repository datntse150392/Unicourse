<div class="header">
  <app-header></app-header>
</div>
<div class="container" *ngIf="blogDetail">
  <!-- Breachrum Group-->
  <nav class="flex mb-4" aria-label="Breadcrumb">
    <ol
      class="inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse"
    >
      <li>
        <div class="flex flex-row items-center">
          <a
            [routerLink]="['/']"
            ariaCurrentWhenActive="page"
            class="mr-1 ms-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ms-2 dark:text-gray-400 dark:hover:text-white"
            >Trang chủ</a
          >
        </div>
      </li>
      /
      <li>
        <div class="flex flex-row items-center">
          <a
            routerLink="/blog"
            [queryParams]="{ page: 1 }"
            ariaCurrentWhenActive="page"
            class="mr-1 ms-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ms-2 dark:text-gray-400 dark:hover:text-white"
            >Bài viết</a
          >
        </div>
      </li>
      /
      <li aria-current="page">
        <div class="flex items-center">
          <span
            class="w-50 ms-1 text-sm font-medium text-gray-950 md:ms-2 font-bold"
            >{{ blogDetail.title }}</span
          >
        </div>
      </li>
    </ol>
  </nav>
  <div class="like_comment">
    <div class="top">
      <!-- FullName -->
      <p class="full-name text-black font-bold text-lg">
        {{ blogDetail.userId.fullName }}
      </p>
      <!-- Bio -->
      <p class="bio font-extralight">
        {{
          blogDetail.userId.role === "student"
            ? "Thành viên của Unicourse"
            : "Ban quản trị"
        }}
      </p>
    </div>
    <div class="bottom flex flex-nowrap items-center justify-between mt-3">
      <div class="like flex flex-nowrap items-center gap-1">
        <ng-container *ngIf="isLikeBlog; else unLikeBlog">
          <img
            width="24"
            height="24"
            src="https://img.icons8.com/fluency/24/like.png"
            alt="like"
            [ngStyle]="{ cursor: 'pointer' }"
            (click)="unlikeBlog()"
        /></ng-container>
        <ng-template #unLikeBlog>
          <img
            width="24"
            height="24"
            src="https://img.icons8.com/material-outlined/24/like--v1.png"
            alt="like--v1"
            [ngStyle]="{ cursor: 'pointer' }"
            (click)="likeBlog()"
          />
        </ng-template>
        <span>{{ blogDetail.like.length || 0 }}</span>
      </div>
      <div
        [ngStyle]="{ cursor: 'pointer' }"
        (click)="sidebarComment = true"
        class="comment flex flex-nowrap items-center gap-1"
      >
        <img
          width="30"
          height="30"
          src="https://img.icons8.com/fluency-systems-regular/30/speech-bubble--v1.png"
          alt="speech-bubble--v1"
        />
        <span>{{ blogDetail.comment_obj.length || 0 }}</span>
      </div>
    </div>
  </div>
  <div class="main-content-container">
    <!-- Title -->
    <h2 class="mb-4">
      {{ blogDetail.title }}
    </h2>
    <!-- Author & Button Save Blog -->
    <div class="author flex flex-nowrap items-center justify-between mb-4">
      <div class="flex flex-nowrap items-center gap-3">
        <p-avatar
          image="{{ blogDetail.userId.profile_image }}"
          size="large"
          shape="circle"
        ></p-avatar>
        <div>
          <p class="author-name">{{ blogDetail.userId.fullName }}</p>
          <p class="date">
            {{ publishedAtString(blogDetail.date_published) }} •
            {{ blogDetail.min_read }} phút đọc
          </p>
        </div>
      </div>
      <!-- Group btn -->
      <div class="group-btn flex flex-nowrap items-center gap-3">
        <i class="pi pi-bookmark" style="font-size: 1.2rem"></i>
        <i class="pi pi-ellipsis-h" style="font-size: 1.2rem"></i>
      </div>
    </div>
    <!-- Content -->
    <div class="mb-4" [innerHTML]="sanitizeContent(blogDetail.content)"></div>
  </div>
  <!-- Footer -->
  <footer class="mb-4">
    <div class="group-btn-footer flex flex-nowrap gap-3 items-center mb-2">
      <div class="like flex flex-nowrap items-center gap-2">
        <ng-container *ngIf="isLikeBlog; else unLikeBlog">
          <img
            width="24"
            height="24"
            src="https://img.icons8.com/fluency/24/like.png"
            alt="like"
            [ngStyle]="{ cursor: 'pointer' }"
            (click)="unlikeBlog()"
        /></ng-container>
        <ng-template #unLikeBlog>
          <img
            width="24"
            height="24"
            src="https://img.icons8.com/material-outlined/24/like--v1.png"
            alt="like--v1"
            [ngStyle]="{ cursor: 'pointer' }"
            (click)="likeBlog()"
          />
        </ng-template>
        <span>{{ blogDetail.like.length || 0 }}</span>
      </div>
      <div
        [ngStyle]="{ cursor: 'pointer' }"
        (click)="sidebarComment = true"
        class="comment flex flex-nowrap items-center gap-2"
      >
        <img
          width="24"
          height="24"
          src="https://img.icons8.com/fluency-systems-regular/24/speech-bubble--v1.png"
          alt="speech-bubble--v1"
        />
        <span>{{ blogDetail.comment_obj.length || 0 }}</span>
      </div>
    </div>
    <div class="badge flex flex-nowrap gap-2">
      <ng-container *ngFor="let tag of blogDetail.tags">
        <p-tag
          value="{{ tag.name }}"
          [style]="{ 'background-color': tag.color }"
        ></p-tag>
      </ng-container>
    </div>
  </footer>
</div>

<p-sidebar
  #sidebarRef
  [(visible)]="sidebarComment"
  class="sidebar-comment"
  position="right"
>
  <ng-template pTemplate="headless">
    <p-button
      class="flex justify-end p-2"
      type="button"
      (click)="closeCallback($event)"
      icon="pi pi-times"
    ></p-button>
    <div class="container-sidebar-comment pr-2 pl-2 pt-4">
      <div class="pr-4 pl-4 mb-6">
        <h2>{{ blogDetail.comment_obj.length || 0 }} bình luận</h2>
        <span
          >(Nếu thấy bình luận spam, các bạn bấm report giúp admin nhé)
        </span>
      </div>

      <!-- Input comment -->
      <ng-container *ngIf="userInfo">
        <div class="pr-4 pl-4 pt-4 flex flex-nowrap gap-4 items-start">
          <p-avatar
            image="{{ userInfo.profile_image }}"
            size="large"
            shape="circle"
          ></p-avatar>
          <ng-container *ngIf="toggleEditor; else DisplayNormalInput">
            <div class="flex flex-col w-full">
              <editor
                class="w-full mb-4"
                [(ngModel)]="editorContentComment"
                apiKey="8oi2m4vzjnoj301r398iggki6v0ukdgpwavrr76kku9cnnpz"
                [init]="{
                  plugins: 'lists link image table code help wordcount'
                }"
              ></editor>

              <div class="flex justify-end">
                <button
                  (click)="toggleEditorComment()"
                  class="btn-cancel-editor"
                >
                  <p>Hủy</p>
                </button>
                <button
                  (click)="sendComment()"
                  *ngIf="editorContentComment !== ''"
                  class="btn-comment"
                >
                  <p>Bình luận</p>
                </button>
              </div>
            </div>
          </ng-container>

          <ng-template #DisplayNormalInput>
            <div class="user-comment" (click)="toggleEditorComment()">
              <p>Nhập bình luận của bạn ...</p>
            </div>
          </ng-template>
        </div>
      </ng-container>

      <!-- Comment User -->
      <div class="mt-6">
        <div
          *ngFor="let comment of blogDetail.comment_obj"
          class="container-body flex flex-nowrap gap-4 p-4 pt-0 mb-2"
        >
          <!-- Avatar -->
          <p-avatar
            image="{{ comment.commentator.profile_image }}"
            size="large"
            shape="circle"
          ></p-avatar>
          <!-- Content -->
          <div class="content">
            <div class="main">
              <div class="flex justify-between items-center">
                <h5 class="mb-2">{{ comment.commentator.fullName }}</h5>
                <span (click)="reportComment()" class="pi pi-ellipsis-h"></span>
              </div>
              <div [innerHTML]="sanitizeContent(comment.comment)"></div>
            </div>
            <div class="sub-main mt-2 flex items-center">
              <p class="mr-2 font-normal">
                {{ publishedAtString(comment.created_at) }}
              </p>
              <p (click)="likeComment()" class="mr-2 p-custome">Thích</p>
              <p (click)="replyComment()" class="mr-2 p-custome">Phản hồi</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</p-sidebar>
