<div class="grid">
	<div class="col-12">
		<div class="card">
			<p-toast></p-toast>
			<p-toolbar styleClass="mb-4">
				<ng-template pTemplate="left">
					<div class="my-2">
						<button pButton pRipple label="New" icon="pi pi-plus" class="p-button-success mr-2"
							(click)="openNew()"></button>
						<button pButton pRipple label="Delete" icon="pi pi-trash" class="p-button-danger"
							(click)="deleteSelectedProducts()"
							[disabled]="!selectedProducts || !selectedProducts.length"></button>
					</div>
				</ng-template>

				<ng-template pTemplate="right">
					<p-fileUpload mode="basic" accept="image/*" [maxFileSize]="1000000" label="Import"
						chooseLabel="Import" class="mr-2 inline-block"></p-fileUpload>
					<button pButton pRipple label="Export" icon="pi pi-upload" class="p-button-help"
						(click)="exportExcel()"></button>
				</ng-template>
			</p-toolbar>
			<h5>Danh sách bài đăng</h5>
			<p-table #dt1 [value]="blogs" dataKey="id" [rows]="10" [loading]="loading" [rowHover]="true"
				styleClass="p-datatable-gridlines" [paginator]="true"
				[globalFilterFields]="['title', 'userId.fullName', 'date', 'status']" responsiveLayout="scroll">
				<ng-template pTemplate="caption">
					<div class="flex justify-content-between flex-column sm:flex-row">
						<button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash"
							(click)="clear(dt1)"></button>
						<span class="p-input-icon-left mb-2">
							<i class="pi pi-search"></i>
							<input pInputText type="text" #filter (input)="onGlobalFilter(dt1, $event)"
								placeholder="Search Keyword" class="w-full" />
						</span>
					</div>
				</ng-template>
				<ng-template pTemplate="header">
					<tr>
						<th style="min-width: 8rem">
							<div class="flex justify-content-between align-items-center">
								Bài đăng
								<p-columnFilter type="text" field="title" display="menu"
									placeholder="Nhập tiêu đề"></p-columnFilter>
							</div>
						</th>
						<th style="min-width: 8rem">
							<div class="flex justify-content-between align-items-center">
								Ảnh thumbnail
							</div>
						</th>
						<th style="min-width: 14rem">
							<div class="flex justify-content-between align-items-center">
								Tác giả
								<p-columnFilter type="text" field="userId.fullName" display="menu"
									placeholder="Nhập tên tác giả"></p-columnFilter>
							</div>
						</th>
						<th style="min-width: 12rem">
							<div class="flex justify-content-between align-items-center">
								Nhãn dán
							</div>
						</th>
						<th style="min-width: 8rem">
							<div class="flex justify-content-between align-items-center">
								Ngày đăng
							</div>
						</th>
						<th style="min-width: 10rem">
							<div class="flex justify-content-between align-items-center">
								Trạng thái
								<p-columnFilter field="status" matchMode="equals" display="menu">
									<ng-template pTemplate="filter" let-value let-filter="filterCallback">
										<p-dropdown [ngModel]="value" [options]="statuses"
											(onChange)="filter($event.value)" placeholder="Any"
											[style]="{'min-width': '12rem'}">
											<ng-template let-option pTemplate="item">
												<span
													[class]="'customer-badge status-' + option.value">{{option.label}}</span>
											</ng-template>
										</p-dropdown>
									</ng-template>
								</p-columnFilter>
							</div>
						</th>
						<th style="min-width:10rem"></th>
					</tr>
				</ng-template>
				<ng-template pTemplate="body" let-blog>
					<tr>
						<td>
							<p class="truncated-text" pTooltip="{{blog.title}}">
								{{blog.title}}
							</p>
						</td>
						<td>
							<div class="group-thumbnail">
								<img [src]="blog.thumbnail_url" [class]="'thumbnail flag flag-' + blog.title">
							</div>
						</td>
						<td>
							<div class="group-avatar">
								<img class="avatar" [alt]="blog.userId.fullName" [src]="blog.userId.profile_image"
									style="vertical-align: middle; border-radius: 5px" />
								<span class="image-text ml-2">{{blog.userId.fullName}}</span>
							</div>
						</td>
						<td>
							<div class="tags">
								<ng-container *ngFor="let tag of blog.tags">
									<span [class]="'customer-badge status-' + blog.status">{{tag}}</span>
								</ng-container>
							</div>
						</td>
						<td>
							{{blog.date_published | date : "dd/MM/yyyy"}}
						</td>
						<td>
							<span [value]="blog.status"
								[class]="'customer-badge status-' + blog.status">{{blog.status}}</span>
						</td>
						<td>
							<button pButton pRipple icon="pi pi-pencil"
								class="p-button-rounded p-button-success mr-2" (click)="editBlog(blog)"></button>
							<button pButton pRipple icon="pi pi-trash"
								class="p-button-rounded p-button-warning" (click)="deleteBlog(blog)"></button>
						</td>
					</tr>
				</ng-template>

				<ng-template pTemplate="emptymessage">
					<tr>
						<td colspan="8">No customers found.</td>
					</tr>
				</ng-template>
				<ng-template pTemplate="loadingbody">
					<tr>
						<td colspan="8">Loading customers data. Please wait.</td>
					</tr>
				</ng-template>
			</p-table>
		</div>

		<!-- Hiển thị dialog -->
		<p-dialog [(visible)]="blogDialog" [style]="{width: '450px'}" header="Chi tiết bài viết" [modal]="true"
			class="p-fluid">
			<ng-template pTemplate="content">
				<img [src]="blog.thumbnail_url" [alt]="blog.title" width="150"
					class="mt-0 mx-auto mb-5 block shadow-2" *ngIf="blog.thumbnail_url">
				<div class="field">
					<label for="title">Tiêu đề</label>
					<input type="text" pInputText id="title" [(ngModel)]="blog.title" required autofocus
						[ngClass]="{'ng-invalid ng-dirty' : submitted && !blog.title}" />
					<small class="ng-dirty ng-invalid" *ngIf="submitted && !blog.title">Tiêu đề không được trống.</small>
				</div>
				<div class="field">
					<label for="description">Mô tả</label>
					<textarea id="description" pInputTextarea [(ngModel)]="blog.description" required rows="3"
						cols="20"></textarea>
				</div>
				<div class="field">
					<label for="status">Trạng thái</label>
					<p-dropdown [(ngModel)]="blog.status" inputId="status" optionValue="label"
						[options]="statuses" placeholder="Chọn">
						<ng-template pTemplate="selectedItem">
							<span *ngIf="blog && blog.status"
								[class]="'product-badge status-' + blog.status.toString().toLowerCase()">{{blog.status}}</span>
						</ng-template>
						<ng-template let-option pTemplate="item">
							<span [class]="'product-badge status-' + option.value">{{option.label}}</span>
						</ng-template>
					</p-dropdown>
				</div>

				<!-- <div class="field">
					<label class="mb-3">Nhãn dán</label>
					<div class="formgrid grid">
						<div class="field-radiobutton col-6">
							<p-radioButton id="tag1" name="tag" value="Accessories"
								[(ngModel)]="blog.tags"></p-radioButton>
							<label for="tag1">Accessories</label>
						</div>
						<div class="field-radiobutton col-6">
							<p-radioButton id="tag2" name="category" value="Clothing"
								[(ngModel)]="product.category"></p-radioButton>
							<label for="tag2">Clothing</label>
						</div>
						<div class="field-radiobutton col-6">
							<p-radioButton id="category3" name="category" value="Electronics"
								[(ngModel)]="product.category"></p-radioButton>
							<label for="category3">Electronics</label>
						</div>
						<div class="field-radiobutton col-6">
							<p-radioButton id="category4" name="category" value="Fitness"
								[(ngModel)]="product.category"></p-radioButton>
							<label for="category4">Fitness</label>
						</div>
					</div>
				</div> -->

				<!-- <div class="formgrid grid">
					<div class="field col">
						<label for="price">Price</label>
						<p-inputNumber id="price" [(ngModel)]="product.price" mode="currency" currency="USD"
							locale="en-US"></p-inputNumber>
					</div>
					<div class="field col">
						<label for="quantity">Quantity</label>
						<p-inputNumber id="quantity" [(ngModel)]="product.quantity"></p-inputNumber>
					</div>
				</div> -->
			</ng-template>

			<ng-template pTemplate="footer">
				<button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text"
					(click)="hideDialog()"></button>
				<button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text"
					(click)="saveBLog()"></button>
			</ng-template>
		</p-dialog>

		<p-dialog [(visible)]="deleteBlogDialog" header="Confirm" [modal]="true" [style]="{width:'450px'}">
			<div class="flex align-items-center justify-content-center">
				<i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
				<span *ngIf="blog">Bạn muốn xóa bài viết <b>{{blog.title}}</b>?</span>
			</div>
			<ng-template pTemplate="footer">
				<button pButton pRipple icon="pi pi-times" class="p-button-text" label="No"
					(click)="deleteBlogDialog = false"></button>
				<button pButton pRipple icon="pi pi-check" class="p-button-text" label="Yes"
					(click)="confirmDelete()"></button>
			</ng-template>
		</p-dialog>
	</div>
</div>